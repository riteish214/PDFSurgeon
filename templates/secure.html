{% extends "base.html" %}

{% block title %}PDF Tools - Secure PDF{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">
                    <i class="fas fa-lock me-2"></i>
                    Add Password Protection
                </h4>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Protect your PDF document with a password. Once protected, 
                    users will need to enter the password to open and view the document.
                </p>

                <form action="{{ url_for('api_secure') }}" method="post" enctype="multipart/form-data" id="secureForm">
                    <div class="mb-4">
                        <label for="file" class="form-label">Select PDF File</label>
                        <input type="file" class="form-control" id="file" name="file" 
                               accept=".pdf" required>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Select a PDF file to protect. Maximum file size: 50MB.
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="password" name="password" 
                                   placeholder="Enter a strong password" required>
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                <i class="fas fa-eye" id="passwordIcon"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            <i class="fas fa-shield-alt me-1"></i>
                            Choose a strong password with at least 8 characters.
                        </div>
                    </div>

                    <!-- Password Strength Indicator -->
                    <div class="mb-4">
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted" id="passwordStrengthText">Password strength will appear here</small>
                    </div>

                    <!-- File Preview -->
                    <div id="filePreview" class="mb-4" style="display: none;">
                        <h6>Selected File:</h6>
                        <div id="filePreviewContainer" class="border rounded p-3 bg-light">
                            <!-- File info will be shown here -->
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg" id="secureBtn" disabled>
                            <i class="fas fa-lock me-2"></i>
                            Protect PDF with Password
                        </button>
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back to Tools
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Security Information -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-shield-alt me-2"></i>
                    Security Information
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-success">What This Does:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success me-2"></i>Encrypts the PDF content</li>
                            <li><i class="fas fa-check text-success me-2"></i>Requires password to open</li>
                            <li><i class="fas fa-check text-success me-2"></i>Prevents unauthorized access</li>
                            <li><i class="fas fa-check text-success me-2"></i>Industry-standard encryption</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-warning">Password Tips:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-arrow-right text-muted me-2"></i>Use at least 8 characters</li>
                            <li><i class="fas fa-arrow-right text-muted me-2"></i>Include uppercase and lowercase</li>
                            <li><i class="fas fa-arrow-right text-muted me-2"></i>Add numbers and symbols</li>
                            <li><i class="fas fa-arrow-right text-muted me-2"></i>Avoid common words</li>
                        </ul>
                    </div>
                </div>
                <div class="alert alert-warning mt-3 mb-0">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        <strong>Important:</strong> Remember your password! If you forget it, you won't be able to open the PDF.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const fileInput = document.getElementById('file');
const passwordInput = document.getElementById('password');
const togglePassword = document.getElementById('togglePassword');
const passwordIcon = document.getElementById('passwordIcon');
const passwordStrength = document.getElementById('passwordStrength');
const passwordStrengthText = document.getElementById('passwordStrengthText');
const filePreview = document.getElementById('filePreview');
const filePreviewContainer = document.getElementById('filePreviewContainer');
const secureBtn = document.getElementById('secureBtn');

// Handle file selection
fileInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    
    if (file) {
        // Show file preview
        filePreview.style.display = 'block';
        filePreviewContainer.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="fas fa-file-pdf text-danger me-3"></i>
                <div>
                    <strong>${file.name}</strong><br>
                    <small class="text-muted">Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                </div>
            </div>
        `;
    } else {
        filePreview.style.display = 'none';
    }
    
    updateSecureButton();
});

// Toggle password visibility
togglePassword.addEventListener('click', function() {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    
    if (type === 'text') {
        passwordIcon.classList.remove('fa-eye');
        passwordIcon.classList.add('fa-eye-slash');
    } else {
        passwordIcon.classList.remove('fa-eye-slash');
        passwordIcon.classList.add('fa-eye');
    }
});

// Password strength checker
passwordInput.addEventListener('input', function() {
    const password = this.value;
    const strength = calculatePasswordStrength(password);
    
    updatePasswordStrength(strength);
    updateSecureButton();
});

function calculatePasswordStrength(password) {
    let score = 0;
    
    if (password.length >= 8) score += 25;
    if (password.match(/[a-z]/)) score += 25;
    if (password.match(/[A-Z]/)) score += 25;
    if (password.match(/[0-9]/)) score += 15;
    if (password.match(/[^a-zA-Z0-9]/)) score += 10;
    
    return Math.min(score, 100);
}

function updatePasswordStrength(strength) {
    passwordStrength.style.width = strength + '%';
    
    if (strength < 30) {
        passwordStrength.className = 'progress-bar bg-danger';
        passwordStrengthText.textContent = 'Weak password';
        passwordStrengthText.className = 'text-danger';
    } else if (strength < 60) {
        passwordStrength.className = 'progress-bar bg-warning';
        passwordStrengthText.textContent = 'Moderate password';
        passwordStrengthText.className = 'text-warning';
    } else if (strength < 80) {
        passwordStrength.className = 'progress-bar bg-info';
        passwordStrengthText.textContent = 'Good password';
        passwordStrengthText.className = 'text-info';
    } else {
        passwordStrength.className = 'progress-bar bg-success';
        passwordStrengthText.textContent = 'Strong password';
        passwordStrengthText.className = 'text-success';
    }
}

function updateSecureButton() {
    const hasFile = fileInput.files.length > 0;
    const hasPassword = passwordInput.value.length >= 8;
    secureBtn.disabled = !(hasFile && hasPassword);
}
</script>
{% endblock %}
